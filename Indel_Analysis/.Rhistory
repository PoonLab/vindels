edge.idx <- tre$edge[,1]==a  # FINDS THE EDGES (row #) corresponding with the parent node ; ap: select rows in edge matrix with parent node index
c(a,   # index of the parent node
which(edge.idx),
t(     # transpose so we can concatenate this vector to i
tre$edge[edge.idx, 2]    # column of tip indices
)
)
})
df <- data.frame(node.index=m[1,], edge1=m[2,], edge2=m[3,], tip1=m[4,], tip2=m[5,])
df$tip1.label <- tre$tip.label[df$tip1]
df$tip2.label <- tre$tip.label[df$tip2]
df$tip1.len <- tre$edge.length[df$edge1]
df$tip2.len <- tre$edge.length[df$edge2]
indels <- df[,c(6:9)]
indels$total.length <- indels$tip1.len + indels$tip2.len
#TERMINAL BRANCH LENGTHS PLOT
branch.lengths <- rbind(branch.lengths, data.frame(subtype=rep(filename,nrow(indels)), length=indels$total.length))
#ROOT TO TIP DISTANCE PLOT
sample.times <- sample.times + 1970
lens <- node.depth.edgelength(rtdtree)[1:Ntip(rtdtree)]
rtdtree2 <- rtdtree
rtdtree2$tip.label <- paste(rtdtree2$tip.label, sample.times, sep="-")
setwd("~/PycharmProjects/hiv-evolution-master/7_Tempest")
write.tree(rtdtree2, file=paste0(filename,".tree"))
setwd("~/PycharmProjects/hiv-evolution-master/8_Dated_Trees")
big.df <- rbind(big.df,data.frame(subtype=rep(filename,Ntip(rtdtree)), dates=sample.times, lengths=lens))
# DATING TREES -----------------------------------
#write.tree(rtdtree, file="rtt2lsd.nwk")
#The following is written in accordance with the LSD format
#write(nrow(temp), file='date_file.txt')
# for (i in 1:nrow(temp)) {
#   if (temp$min.ord[i] == temp$max.ord[i]) {
#     write(paste(temp$accno[i], temp$min.ord[i]), file='date_file.txt', append=TRUE)
#   } else {
#     write(paste(temp$accno[i], paste0("b(", temp$min.ord[i], ",", temp$max.ord[i], ")")),
#           file='date_file.txt', append=TRUE)
#   }
# }
#print(i)
#paths <- nodepath(rtdtree)
#distances <- c()
#for (n in 1:length(paths))  distances <- c(distances, sum(rtdtree$edge.length[paths[[n]]]))
#system(paste0('lsd -i rtt2lsd.nwk -d date_file.txt -o ', filename,' -c'))
}
big.df <- big.df[which(big.df$dates>1960),]
new.df <- split(big.df[,2:3],big.df[,1])
require(survey)
require(scales)
par(mar=c(5,5,4,3))
require(RColorBrewer)
cols <- brewer.pal(7,"Dark2")
par(mfrow=c(4,2),las=1)
names <- c("AE", "AG","A1","B","C","D","F1")
letters <- c("a","b","c","d","e","f","g")
lims <- c()
xconint <- data.frame()
for (m in 1:7){
par(mar=c(4.5,6,1,1))
xval <- new.df[m][[1]][,1]
yval <- new.df[m][[1]][,2]
#buffer <- 0.01*(range(xval)[2] - range(new.df[m][[1]][,1])[1])
#newx <- min(new.df[m][[1]][,1])-buffer
plot(x=jitter(xval,amount=0.45), y=yval, col=alpha(cols[m],0.35), xlim=c(1979,2016),
ylim=c(0,0.30), cex=1,pch=20,
xlab="Collection Date",ylab="Root-to-Tip Branch Length", cex.lab=1.1)
lreg <- lm(lengths~dates ,data=new.df[m][[1]])
#compute the 95% conf ints for slope
cislope <- c(confint(lreg)[2],confint(lreg)[4])
rsqr <- signif(summary(lreg)$adj.r.squared,2)
slope <- signif(lreg$coefficients[2][[1]],2)
xest <- svycontrast(lreg, quote(-`(Intercept)`/dates))
xint <- coef(xest)[[1]]
se <- SE(xest)[[1]]
xconint <- rbind(xconint, data.frame(subtype=names[m],xint=xint,xlow=xint-se, xhigh=xint+se, slope= signif(lreg$coefficients[2][[1]],2), slo=cislope[1], shi=cislope[2],rsqrd=rsqr))
abline(lreg,lwd=1.5)
#print(summary(lreg))
text(1979.7,0.285,labels=names[m], cex=1.6)
eqn <- paste0("y = ", signif(lreg$coefficients[2][[1]],2), "x ", signif(lreg$coefficients[1][[1]],2))
#text(1998,0.275,labels=eqn, cex=1.1)
#rsqr <- paste0(txt, get(signif(summary(lreg)$adj.r.squared,2)))
#text(2012,0.29,labels=expression(paste(R^2,"= ")), cex=1.1)
#text(2015,0.286,labels=rsqr,cex=1.1)
par(xpd=NA)
text(1970,0.31,labels=paste0(letters[m],")"), cex=1.5)
par(xpd=F)
}
install.packages("xtable")
lxtable <- xtable(treedata)
require(xtable)
lxtable <- xtable(treedata)
# BRANCH LENGTHS PLOT --------------------------------
par(mar=c(6,7,2,2))
branch.len2 <- split(branch.lengths$length, branch.lengths$subtype)
boxplot(branch.len2, xlab="Subtype",cex.lab=1.3,las=1)
par(las=3)
mtext(side = 2, text = "Terminal Branch Lengths (Expected Substitutions)", line = 4, cex=1.3)
#--------------------------------
big.df <- big.df[which(big.df$dates>1960),]
new.df <- split(big.df[,2:3],big.df[,1])
require(survey)
require(scales)
par(mar=c(5,5,4,3))
require(RColorBrewer)
cols <- brewer.pal(7,"Dark2")
par(mfrow=c(4,2),las=1)
names <- c("AE", "AG","A1","B","C","D","F1")
letters <- c("a","b","c","d","e","f","g")
lims <- c()
treedata <- data.frame()
for (m in 1:7){
par(mar=c(4.5,6,1,1))
xval <- new.df[m][[1]][,1]
yval <- new.df[m][[1]][,2]
#buffer <- 0.01*(range(xval)[2] - range(new.df[m][[1]][,1])[1])
#newx <- min(new.df[m][[1]][,1])-buffer
plot(x=jitter(xval,amount=0.45), y=yval, col=alpha(cols[m],0.35), xlim=c(1979,2016),
ylim=c(0,0.30), cex=1,pch=20,
xlab="Collection Date",ylab="Root-to-Tip Branch Length", cex.lab=1.1)
lreg <- lm(lengths~dates ,data=new.df[m][[1]])
#compute the 95% conf ints for slope
cislope <- c(confint(lreg)[2],confint(lreg)[4])
rsqr <- signif(summary(lreg)$adj.r.squared,2)
slope <- signif(lreg$coefficients[2][[1]],2)
xest <- svycontrast(lreg, quote(-`(Intercept)`/dates))
xint <- coef(xest)[[1]]
se <- SE(xest)[[1]]
treedata <- rbind(treedata, data.frame(subtype=names[m],xint=xint,xlow=xint-se, xhigh=xint+se, slope= signif(lreg$coefficients[2][[1]],2), slo=cislope[1], shi=cislope[2],rsqrd=rsqr))
abline(lreg,lwd=1.5)
#print(summary(lreg))
text(1979.7,0.285,labels=names[m], cex=1.6)
eqn <- paste0("y = ", signif(lreg$coefficients[2][[1]],2), "x ", signif(lreg$coefficients[1][[1]],2))
#text(1998,0.275,labels=eqn, cex=1.1)
#rsqr <- paste0(txt, get(signif(summary(lreg)$adj.r.squared,2)))
#text(2012,0.29,labels=expression(paste(R^2,"= ")), cex=1.1)
#text(2015,0.286,labels=rsqr,cex=1.1)
par(xpd=NA)
text(1970,0.31,labels=paste0(letters[m],")"), cex=1.5)
par(xpd=F)
}
treedata
lxtable <- xtable(treedata)
lxtable
lxtable
autoformat(lxtable)
big.df <- big.df[which(big.df$dates>1960),]
new.df <- split(big.df[,2:3],big.df[,1])
require(survey)
require(scales)
par(mar=c(5,5,4,3))
require(RColorBrewer)
cols <- brewer.pal(7,"Dark2")
par(mfrow=c(4,2),las=1)
names <- c("AE", "AG","A1","B","C","D","F1")
letters <- c("a","b","c","d","e","f","g")
lims <- c()
treedata <- data.frame()
for (m in 1:7){
par(mar=c(4.5,6,1,1))
xval <- new.df[m][[1]][,1]
yval <- new.df[m][[1]][,2]
#buffer <- 0.01*(range(xval)[2] - range(new.df[m][[1]][,1])[1])
#newx <- min(new.df[m][[1]][,1])-buffer
plot(x=jitter(xval,amount=0.45), y=yval, col=alpha(cols[m],0.35), xlim=c(1979,2016),
ylim=c(0,0.30), cex=1,pch=20,
xlab="Collection Date",ylab="Root-to-Tip Branch Length", cex.lab=1.1)
lreg <- lm(lengths~dates ,data=new.df[m][[1]])
#compute the 95% conf ints for slope
cislope <- c(confint(lreg)[2],confint(lreg)[4])
rsqr <- signif(summary(lreg)$adj.r.squared,2)
slope <- signif(lreg$coefficients[2][[1]],2)
xest <- svycontrast(lreg, quote(-`(Intercept)`/dates))
xint <- coef(xest)[[1]]
se <- SE(xest)[[1]]
treedata <- rbind(treedata, data.frame(Clade=names[m],Estimate= signif(lreg$coefficients[2][[1]],2), slo=cislope[1], shi=cislope[2], xint=xint,x low=xint-se, xhigh=xint+se,rsqrd=rsqr))
abline(lreg,lwd=1.5)
#print(summary(lreg))
text(1979.7,0.285,labels=names[m], cex=1.6)
eqn <- paste0("y = ", signif(lreg$coefficients[2][[1]],2), "x ", signif(lreg$coefficients[1][[1]],2))
#text(1998,0.275,labels=eqn, cex=1.1)
#rsqr <- paste0(txt, get(signif(summary(lreg)$adj.r.squared,2)))
#text(2012,0.29,labels=expression(paste(R^2,"= ")), cex=1.1)
#text(2015,0.286,labels=rsqr,cex=1.1)
par(xpd=NA)
text(1970,0.31,labels=paste0(letters[m],")"), cex=1.5)
par(xpd=F)
}
lxtable <- xtable(treedata)
setwd("~/vindels/Indel_Analysis")
write.csv(treedata,file="tree_data.csv")
new.df <- split(big.df[,2:3],big.df[,1])
require(survey)
require(scales)
par(mar=c(5,5,4,3))
require(RColorBrewer)
cols <- brewer.pal(7,"Dark2")
par(mfrow=c(4,2),las=1)
names <- c("AE", "AG","A1","B","C","D","F1")
letters <- c("a","b","c","d","e","f","g")
lims <- c()
treedata <- data.frame()
for (m in 1:7){
par(mar=c(4.5,6,1,1))
xval <- new.df[m][[1]][,1]
yval <- new.df[m][[1]][,2]
#buffer <- 0.01*(range(xval)[2] - range(new.df[m][[1]][,1])[1])
#newx <- min(new.df[m][[1]][,1])-buffer
plot(x=jitter(xval,amount=0.45), y=yval, col=alpha(cols[m],0.35), xlim=c(1979,2016),
ylim=c(0,0.30), cex=1,pch=20,
xlab="Collection Date",ylab="Root-to-Tip Branch Length", cex.lab=1.1)
lreg <- lm(lengths~dates ,data=new.df[m][[1]])
#compute the 95% conf ints for slope
cislope <- c(confint(lreg)[2],confint(lreg)[4])
rsqr <- signif(summary(lreg)$adj.r.squared,2)
slope <- signif(lreg$coefficients[2][[1]],2)
xest <- svycontrast(lreg, quote(-`(Intercept)`/dates))
xint <- coef(xest)[[1]]
se <- SE(xest)[[1]]
treedata <- rbind(treedata, data.frame(Clade=names[m],Estimate= signif(lreg$coefficients[2][[1]],2), slo=cislope[1], shi=cislope[2], xint=xint,xlow=xint-se, xhigh=xint+se,rsqrd=rsqr))
abline(lreg,lwd=1.5)
#print(summary(lreg))
text(1979.7,0.285,labels=names[m], cex=1.6)
eqn <- paste0("y = ", signif(lreg$coefficients[2][[1]],2), "x ", signif(lreg$coefficients[1][[1]],2))
#text(1998,0.275,labels=eqn, cex=1.1)
#rsqr <- paste0(txt, get(signif(summary(lreg)$adj.r.squared,2)))
#text(2012,0.29,labels=expression(paste(R^2,"= ")), cex=1.1)
#text(2015,0.286,labels=rsqr,cex=1.1)
par(xpd=NA)
text(1970,0.31,labels=paste0(letters[m],")"), cex=1.5)
par(xpd=F)
}
treedata
big.df <- big.df[which(big.df$dates>1960),]
new.df <- split(big.df[,2:3],big.df[,1])
require(survey)
require(scales)
par(mar=c(5,5,4,3))
require(RColorBrewer)
cols <- brewer.pal(7,"Dark2")
par(mfrow=c(4,2),las=1)
names <- c("AE", "AG","A1","B","C","D","F1")
letters <- c("a","b","c","d","e","f","g")
lims <- c()
treedata <- data.frame()
for (m in 1:7){
par(mar=c(4.5,6,1,1))
xval <- new.df[m][[1]][,1]
yval <- new.df[m][[1]][,2]
#buffer <- 0.01*(range(xval)[2] - range(new.df[m][[1]][,1])[1])
#newx <- min(new.df[m][[1]][,1])-buffer
plot(x=jitter(xval,amount=0.45), y=yval, col=alpha(cols[m],0.35), xlim=c(1979,2016),
ylim=c(0,0.30), cex=1,pch=20,
xlab="Collection Date",ylab="Root-to-Tip Branch Length", cex.lab=1.1)
lreg <- lm(lengths~dates ,data=new.df[m][[1]])
#compute the 95% conf ints for slope
cislope <- c(confint(lreg)[2],confint(lreg)[4])
rsqr <- signif(summary(lreg)$adj.r.squared,2)
slope <- signif(lreg$coefficients[2][[1]],2)
xest <- svycontrast(lreg, quote(-`(Intercept)`/dates))
xint <- coef(xest)[[1]]
se <- SE(xest)[[1]]
options(scipen =0)
treedata <- rbind(treedata, data.frame(Clade=names[m],Estimate= signif(lreg$coefficients[2][[1]],2), slo=cislope[1], shi=cislope[2], xint=xint,xlow=xint-se, xhigh=xint+se,rsqrd=rsqr))
abline(lreg,lwd=1.5)
#print(summary(lreg))
text(1979.7,0.285,labels=names[m], cex=1.6)
eqn <- paste0("y = ", signif(lreg$coefficients[2][[1]],2), "x ", signif(lreg$coefficients[1][[1]],2))
#text(1998,0.275,labels=eqn, cex=1.1)
#rsqr <- paste0(txt, get(signif(summary(lreg)$adj.r.squared,2)))
#text(2012,0.29,labels=expression(paste(R^2,"= ")), cex=1.1)
#text(2015,0.286,labels=rsqr,cex=1.1)
par(xpd=NA)
text(1970,0.31,labels=paste0(letters[m],")"), cex=1.5)
par(xpd=F)
}
treedata
big.df <- big.df[which(big.df$dates>1960),]
new.df <- split(big.df[,2:3],big.df[,1])
require(survey)
require(scales)
par(mar=c(5,5,4,3))
require(RColorBrewer)
cols <- brewer.pal(7,"Dark2")
par(mfrow=c(4,2),las=1)
names <- c("AE", "AG","A1","B","C","D","F1")
letters <- c("a","b","c","d","e","f","g")
lims <- c()
treedata <- data.frame()
for (m in 1:7){
par(mar=c(4.5,6,1,1))
xval <- new.df[m][[1]][,1]
yval <- new.df[m][[1]][,2]
#buffer <- 0.01*(range(xval)[2] - range(new.df[m][[1]][,1])[1])
#newx <- min(new.df[m][[1]][,1])-buffer
plot(x=jitter(xval,amount=0.45), y=yval, col=alpha(cols[m],0.35), xlim=c(1979,2016),
ylim=c(0,0.30), cex=1,pch=20,
xlab="Collection Date",ylab="Root-to-Tip Branch Length", cex.lab=1.1)
lreg <- lm(lengths~dates ,data=new.df[m][[1]])
#compute the 95% conf ints for slope
cislope <- c(confint(lreg)[2],confint(lreg)[4])
rsqr <- signif(summary(lreg)$adj.r.squared,2)
slope <- signif(lreg$coefficients[2][[1]],2)
xest <- svycontrast(lreg, quote(-`(Intercept)`/dates))
xint <- coef(xest)[[1]]
se <- SE(xest)[[1]]
treedata <- rbind(treedata, data.frame(Clade=names[m],Estimate= signif(lreg$coefficients[2][[1]],2), slo=signif(cislope[1],2), shi=signif(cislope[2],2), xint=xint,xlow=xint-se, xhigh=xint+se,rsqrd=rsqr))
abline(lreg,lwd=1.5)
#print(summary(lreg))
text(1979.7,0.285,labels=names[m], cex=1.6)
eqn <- paste0("y = ", signif(lreg$coefficients[2][[1]],2), "x ", signif(lreg$coefficients[1][[1]],2))
#text(1998,0.275,labels=eqn, cex=1.1)
#rsqr <- paste0(txt, get(signif(summary(lreg)$adj.r.squared,2)))
#text(2012,0.29,labels=expression(paste(R^2,"= ")), cex=1.1)
#text(2015,0.286,labels=rsqr,cex=1.1)
par(xpd=NA)
text(1970,0.31,labels=paste0(letters[m],")"), cex=1.5)
par(xpd=F)
}
treedata
?formatC
slope <- formatC(lreg$coefficients[2][[1]],format="e",digits=2)
slope
?stringr
??stringr
?strsplit
strplit(slope,"e")[1]
strsplit(slope,"e")[1]
strsplit(slope,"e")[[1]]
strsplit(slope,"e")[[1]][1]
#compute the 95% conf ints for slope
cislope <- c(strsplit(formatC(confint(lreg)[2],format="e",digits=2),"e")[[1]][1],confint(lreg)[4])
cislope
confint(lreg)
confint(lreg)[2]
confint(lreg)[[1]]
confint(lreg)[[3]]
confint(lreg)[[2]]
confint(lreg)[[4]]
#compute the 95% conf ints for slope
cislope <- c(strsplit(formatC(confint(lreg)[2],format="e",digits=2),"e")[[1]][1],
strsplit(formatC(confint(lreg)[4],format="e",digits=2),"e")[[1]][1])
cislope
slope
slope <- strsplit(formatC(lreg$coefficients[2][[1]],format="e",digits=2),"e")[[1]][1]
slope
slope <- strsplit(formatC(lreg$coefficients[2][[1]],format="e",digits=2),"e")[[1]]
slope[2]
slope[1]
treedata <- rbind(treedata, data.frame(Clade=names[m],
Estimate= paste0("$",slope[1],"(",cislope[1],",",cislope[2],")\times 10^{",slope[2],"}$",xint=xint,xlow=xint-se, xhigh=xint+se,rsqrd=rsqr))
abline(lreg,lwd=1.5)
#print(summary(lreg))
text(1979.7,0.285,labels=names[m], cex=1.6)
eqn <- paste0("y = ", signif(lreg$coefficients[2][[1]],2), "x ", signif(lreg$coefficients[1][[1]],2))
#text(1998,0.275,labels=eqn, cex=1.1)
#rsqr <- paste0(txt, get(signif(summary(lreg)$adj.r.squared,2)))
#text(2012,0.29,labels=expression(paste(R^2,"= ")), cex=1.1)
#text(2015,0.286,labels=rsqr,cex=1.1)
par(xpd=NA)
text(1970,0.31,labels=paste0(letters[m],")"), cex=1.5)
par(xpd=F)
}
lxtable <- xtable(treedata)
setwd("~/vindels/Indel_Analysis")
write.csv(treedata,file="tree_data.csv")
# for (m in 1:7){
#   par(mar=c(4.5,6,1,1))
#   buffer <- 0.01*(range(new.df[m][[1]][,1])[2] - range(new.df[m][[1]][,1])[1])
#   newx <- min(new.df[m][[1]][,1])-buffer
#   plot(x=jitter(new.df[m][[1]][,1],amount=0.45), y=new.df[m][[1]][,2], col=alpha(cols[m],0.35), xlim=c(1980,2016),
#        ylim=c(0,0.30), cex=1,pch=20,
#        xlab="Collection Date",ylab="Root-to-Tip Branch Length", cex.lab=1.1)
#   abline(lm(new.df[m][[1]][,2]~new.df[m][[1]][,1]),lwd=1.5)
#   text(newx+buffer*2,0.285,labels=names[m], cex=1.4)
#   par(xpd=NA)
#   text(newx-buffer*25,0.31,labels=paste0(letters[m],")"), cex=1.5)
#   par(xpd=F)
# }
plot(x=jitter(dfAE$dates,amount=0.3), y=dfAE$lengths, col=alpha(cols[1],0.7), xlim=c(1982,2016),ylim=c(0.05,0.25), cex=0.8,pch=20,
xlab="Collection Date",ylab="Root-to-Tip Branch Length\n", main="Tree Branch Lengths vs. Collection Dates -- AE", cex.lab=1.4,cex.main=1.6)
abline(lm(dfAE[,2]~dfAE[,1]),lwd=1.5)
par(mar=c(6,6,4,4))
plot(x=jitter(dfB$dates,amount=0.5), y=dfB$lengths, col=alpha(as.character(dfB$color),0.5), cex=0.8,pch=20,
xlab="Collection Date",ylab="Root-to-Tip Branch Length", main="Tree Branch Lengths vs. Collection Dates -- Subtype B",cex.lab=1.3,cex.main=1.6)
abline(lm(dfB[,2]~dfB[,1]))
par(mar=c(6,6,4,4))
plot(x=jitter(dfC$dates,amount=0.5), y=dfC$lengths, col=alpha(cols[1],0.5),cex=1,pch=20,
xlab="Collection Date",ylab="Root-to-Tip Branch Length", main="Tree Branch Lengths vs. Collection Dates -- Subtype C",cex.lab=1.3,cex.main=1.6)
abline(lm(dfC[,2]~dfC[,1]))
xint
xest
?coef
coef(xest)
SE(xest)
se
xint
sprintf
?sprintf
big.df <- big.df[which(big.df$dates>1960),]
new.df <- split(big.df[,2:3],big.df[,1])
require(survey)
require(scales)
par(mar=c(5,5,4,3))
require(RColorBrewer)
cols <- brewer.pal(7,"Dark2")
par(mfrow=c(4,2),las=1)
names <- c("AE", "AG","A1","B","C","D","F1")
letters <- c("a","b","c","d","e","f","g")
lims <- c()
treedata <- data.frame()
for (m in 1:7){
par(mar=c(4.5,6,1,1))
xval <- new.df[m][[1]][,1]
yval <- new.df[m][[1]][,2]
#buffer <- 0.01*(range(xval)[2] - range(new.df[m][[1]][,1])[1])
#newx <- min(new.df[m][[1]][,1])-buffer
plot(x=jitter(xval,amount=0.45), y=yval, col=alpha(cols[m],0.35), xlim=c(1979,2016),
ylim=c(0,0.30), cex=1,pch=20,
xlab="Collection Date",ylab="Root-to-Tip Branch Length", cex.lab=1.1)
lreg <- lm(lengths~dates ,data=new.df[m][[1]])
#compute the 95% conf ints for slope
cislope <- c(strsplit(formatC(confint(lreg)[2],format="e",digits=2),"e")[[1]][1],
strsplit(formatC(confint(lreg)[4],format="e",digits=2),"e")[[1]][1])
rsqr <- signif(summary(lreg)$adj.r.squared,2)
slope <- strsplit(formatC(lreg$coefficients[2][[1]],format="e",digits=2),"e")[[1]]
xest <- svycontrast(lreg, quote(-`(Intercept)`/dates))
xint <- coef(xest)[[1]]
se <- SE(xest)[[1]]
treedata <- rbind(treedata, data.frame(Clade=names[m],
Estimate= sprintf("$%s(%s,%s)\times 10^{%s}$",slope[1],cislope[1],cislope[2],slope[2]),
`$x$-Intercept (Year)`=sprintf("%s(%s,%s)",xint,xint-se,xint+se),
`$R^2$`=rsqr))
abline(lreg,lwd=1.5)
#print(summary(lreg))
text(1979.7,0.285,labels=names[m], cex=1.6)
eqn <- paste0("y = ", signif(lreg$coefficients[2][[1]],2), "x ", signif(lreg$coefficients[1][[1]],2))
#text(1998,0.275,labels=eqn, cex=1.1)
#rsqr <- paste0(txt, get(signif(summary(lreg)$adj.r.squared,2)))
#text(2012,0.29,labels=expression(paste(R^2,"= ")), cex=1.1)
#text(2015,0.286,labels=rsqr,cex=1.1)
par(xpd=NA)
text(1970,0.31,labels=paste0(letters[m],")"), cex=1.5)
par(xpd=F)
}
treedata
sprintf()
?sprintf
treedata <- rbind(treedata, data.frame(Clade=names[m],
Estimate= sprintf("$%s(%s,%s)\times 10^{%s}$",slope[1],cislope[1],cislope[2],slope[2]),
"$x$-Intercept (Year)"=sprintf("%s(%s,%s)",xint,xint-se,xint+se),
"$R^2$"=rsqr))
treedata
xint <- signif(coef(xest)[[1]],2)
se <- SE(xest)[[1]]
treedata <- rbind(treedata, data.frame(Clade=names[m],
Estimate= sprintf("$%s(%s,%s)\times 10^{%s}$",slope[1],cislope[1],cislope[2],slope[2]),
"$x$-Intercept (Year)"=sprintf("%s(%s,%s)",xint,xint-se,xint+se),
"$R^2$"=rsqr))
treedata
se <- signif(SE(xest)[[1]],2)
treedata <- rbind(treedata, data.frame(Clade=names[m],
Estimate= sprintf("$%s(%s,%s)\times 10^{%s}$",slope[1],cislope[1],cislope[2],slope[2]),
"$x$-Intercept (Year)"=sprintf("%s(%s,%s)",xint,xint-se,xint+se),
"$R^2$"=rsqr))
treedata
big.df <- big.df[which(big.df$dates>1960),]
new.df <- split(big.df[,2:3],big.df[,1])
require(survey)
require(scales)
par(mar=c(5,5,4,3))
require(RColorBrewer)
cols <- brewer.pal(7,"Dark2")
par(mfrow=c(4,2),las=1)
names <- c("AE", "AG","A1","B","C","D","F1")
letters <- c("a","b","c","d","e","f","g")
lims <- c()
treedata <- data.frame()
for (m in 1:7){
par(mar=c(4.5,6,1,1))
xval <- new.df[m][[1]][,1]
yval <- new.df[m][[1]][,2]
#buffer <- 0.01*(range(xval)[2] - range(new.df[m][[1]][,1])[1])
#newx <- min(new.df[m][[1]][,1])-buffer
plot(x=jitter(xval,amount=0.45), y=yval, col=alpha(cols[m],0.35), xlim=c(1979,2016),
ylim=c(0,0.30), cex=1,pch=20,
xlab="Collection Date",ylab="Root-to-Tip Branch Length", cex.lab=1.1)
lreg <- lm(lengths~dates ,data=new.df[m][[1]])
#compute the 95% conf ints for slope
cislope <- c(strsplit(formatC(confint(lreg)[2],format="e",digits=2),"e")[[1]][1],
strsplit(formatC(confint(lreg)[4],format="e",digits=2),"e")[[1]][1])
rsqr <- signif(summary(lreg)$adj.r.squared,2)
slope <- strsplit(formatC(lreg$coefficients[2][[1]],format="e",digits=2),"e")[[1]]
xest <- svycontrast(lreg, quote(-`(Intercept)`/dates))
xint <- signif(coef(xest)[[1]],2)
se <- signif(SE(xest)[[1]],2)
treedata <- rbind(treedata, data.frame(Clade=names[m],
Estimate= sprintf("$%s(%s,%s)\times 10^{%s}$",slope[1],cislope[1],cislope[2],slope[2]),
"$x$-Intercept (Year)"=sprintf("%s(%s,%s)",xint,xint-se,xint+se),
"$R^2$"=rsqr))
abline(lreg,lwd=1.5)
#print(summary(lreg))
text(1979.7,0.285,labels=names[m], cex=1.6)
eqn <- paste0("y = ", signif(lreg$coefficients[2][[1]],2), "x ", signif(lreg$coefficients[1][[1]],2))
#text(1998,0.275,labels=eqn, cex=1.1)
#rsqr <- paste0(txt, get(signif(summary(lreg)$adj.r.squared,2)))
#text(2012,0.29,labels=expression(paste(R^2,"= ")), cex=1.1)
#text(2015,0.286,labels=rsqr,cex=1.1)
par(xpd=NA)
text(1970,0.31,labels=paste0(letters[m],")"), cex=1.5)
par(xpd=F)
}
treedata
?round
